#!/bin/bash

S=$(bin/cli_phpfpm cat /usr/local/etc/php/php.ini | grep -iGc 'xdebug.mode = off');

#otra forma de desactivar
#sed -i -e 's/^zend_extension/\;zend_extension/g' /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini

xdebug_status() {
    if [[ $S == 1 ]]; then
        echo "Xdebug debug esta Desactivado."
    else
        echo "Xdebug debug esta Habilitado."
    fi
}

xdebug_enable() {
    if [[ $S == 1 ]]; then
        bin/root_phpfpm sed -i -e 's/^xdebug.mode = off/xdebug.mode = debug/g' /usr/local/etc/php/php.ini
        sleep 1
        bin/restart
        echo "Xdebug debug se ha habilitado"
    else
        echo "Xdebug debug ya esta habilitado."
    fi
}

xdebug_disable() {
    if [[ $S == 0 ]]; then
        bin/root_phpfpm sed -i -e 's/^xdebug.mode = debug/xdebug.mode = off/g' /usr/local/etc/php/php.ini
        sleep 1
        bin/restart
        echo "Xdebug debug se ha desactivado"
    else
        echo "Xdebug debug ya esta desactivado."
    fi
}

firstArgLetter="$(echo "$1" | head -c 1)"

if [[ $firstArgLetter == "d" ]]; then
    xdebug_disable
elif [[ $firstArgLetter == "e" ]]; then
    xdebug_enable
elif [[ $firstArgLetter == "s" ]]; then
    xdebug_status
else
    printf "Por favor escriba 'disable', 'enable', or 'status'.\nEj: bin/xdebug status\n"
fi
